application: traefik
clusterConfig:
  namespace: traefik
chart:
  name: traefik
  releaseName: traefik
  repoURL: https://traefik.github.io/charts
  targetRevision: v34.4.1
  values: |
    additionalArguments:
      - --certificatesresolvers.cloudflare.acme.dnschallenge.provider=cloudflare
      - --certificatesresolvers.cloudflare.acme.email=gabidachaba@gmail.com
      - --certificatesresolvers.cloudflare.acme.dnschallenge.resolvers=1.1.1.1
      - --certificatesresolvers.cloudflare.acme.storage=/ssl-certs/acme-cloudflare.json

  env:
    - name: CF_API_KEY
      valueFrom:
        secretKeyRef:
          name: cloudflare-credentials
          key: apikey

  logs:
    general:
      level: "ERROR"

  ports:
    web:
      redirections:
        entryPoint:
          to: websecure
          scheme: https
          tls:
          enabled: true
          certResolver: cloudflare

  persistence:
    enabled: true
    name: ssl-certs
    size: 2Gi
    accessMode: ReadWriteOnce
    storageClassName: managed-premium
    path: /ssl-certs

  deployment:
    initContainers:
      - name: volume-permissions
        image: busybox:latest
        command:
          [
            "sh",
            "-c",
            "touch /ssl-certs/acme-cloudflare.json; chmod -Rv 600 /ssl-certs/acme-cloudflare.json",
          ]
        volumeMounts:
        - name: ssl-certs
          mountPath: /ssl-certs

  ingressClass:
    enabled: true
    isDefaultClass: true

  resources:
    requests:
      cpu: 250m
      memory: 256Mi
    limits:
      cpu: "500m"
      memory: 512Mi
